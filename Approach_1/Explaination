Overview
This tool takes unstructured, free-text provider specialty descriptions and maps them to official NUCC taxonomy codes using fuzzy matching and intelligent text processing.
How the Mapping Works
1. Data Preprocessing
The mapper first loads the NUCC taxonomy reference data and preprocesses it:

Combined Search Text: Creates a searchable text field combining Classification, Specialization, Display_Name, and Grouping fields
Search Terms Extraction: Extracts individual terms from compound classifications (splits on '&' and '/')
Synonym Dictionary: Builds a comprehensive dictionary of medical specialty abbreviations and common variations (e.g., "ent" → "otolaryngology", "cardio" → "cardiology")

2. Input Processing
Raw specialty text undergoes several cleaning steps:

Converts to lowercase
Removes common medical prefixes/suffixes (dept, clinic, physician, doctor, etc.)
Applies synonym substitution (replaces abbreviations with full terms)
Normalizes whitespace and punctuation

3. Multi-Strategy Matching
The mapper uses three complementary strategies to find matches:
Strategy 1: Exact Term Matching

Checks if the processed input exactly matches any extracted search term
Provides 100% match score for exact matches

Strategy 2: Fuzzy String Matching

Uses RapidFuzz library to calculate similarity scores
Compares against the combined search text using three methods:

Ratio: Overall string similarity
Partial Ratio: Best matching substring
Token Sort Ratio: Word-order independent matching


Takes the best score from all three methods
Threshold: 70% similarity for consideration

Strategy 3: Component Word Matching

Calculates word overlap between input and taxonomy fields
Measures how many input words appear in Classification or Specialization
Useful for multi-word specialties where partial matches are meaningful

4. Confidence Scoring
Each match receives a confidence score based on:

Base similarity score (0-1)
Match type bonus:

Exact matches: +0.3 bonus
Partial matches: +0.1 bonus
Component matches: No bonus



5. Result Aggregation

Groups matches by NUCC code (same code may match through different strategies)
Keeps the highest confidence for each code
Filters results by confidence threshold (default: 0.7)
Returns codes in pipe-separated format (e.g., "code1|code2|code3")

6. Output Classification
Results are classified as:

Mapped: One or more NUCC codes with confidence ≥ threshold
JUNK: No matches found, empty input, or confidence below threshold

Usage
bashpython mapper.py \
  --nucc path/to/nucc_taxonomy.csv \
  --input path/to/raw_specialties.csv \
  --out path/to/output.csv \
  --confidence 0.7
Input Format
CSV file with a raw_specialty column containing free-text specialty descriptions.
Output Format
CSV file with columns:

raw_specialty: Original input text
nucc_codes: Pipe-separated NUCC codes or "JUNK"
confidence: Average confidence score (0-1)
explain: Human-readable explanation of the mapping

Key Features

Robust synonym handling: 40+ medical abbreviations and variations
Multi-strategy matching: Combines exact, fuzzy, and component-based approaches
Confidence scoring: Transparent quality metrics for each mapping
Handles complex inputs: Splits compound specialties and removes noise words
Configurable threshold: Adjust confidence requirements based on use case
1. Data Preprocessing Phase

Loads NUCC taxonomy reference data (contains Classification, Specialization, Display_Name, Grouping fields)
Creates a combined search text from all relevant fields
Extracts unique search terms by splitting compound terms (e.g., "Surgery & Medicine" → ["surgery", "medicine"])
Builds a synonym dictionary for medical abbreviations and common variations

2. Input Normalization
For each raw specialty input:

Converts to lowercase
Removes common medical prefixes/suffixes (dept, clinic, doctor, physician, etc.)
Removes punctuation (except & and /)
Applies synonym substitution (e.g., "cardio" → "cardiology", "ent" → "otolaryngology")
Normalizes whitespace

3. Multi-Strategy Matching
The algorithm uses three parallel matching strategies:
Strategy 1: Exact Term Matching

Checks if processed input exactly matches any extracted search term
Returns confidence score of 100% if match found
Most reliable but strictest approach

Strategy 2: Fuzzy String Matching

Uses three fuzzy matching algorithms from rapidfuzz library:

ratio: Overall string similarity
partial_ratio: Substring matching
token_sort_ratio: Word-order independent matching


Takes the maximum score from all three methods
Threshold: 70% similarity minimum
Adjusts confidence based on match quality (95%+ = exact, else = partial)

Strategy 3: Component Word Overlap

Splits input and taxonomy fields into individual words
Calculates overlap ratio between input words and classification/specialization words
Uses Jaccard-style similarity: |intersection| / |taxonomy_words|
Requires >50% overlap to consider a match

4. Confidence Calculation
Each match gets a confidence score adjusted by:

Base score from matching algorithm
Match type bonus (exact: +0.3, partial: +0.1, component: base only)
Capped at 1.0 maximum

5. Result Aggregation

Groups all matches by taxonomy code
Keeps highest confidence score per code
Filters out matches below confidence threshold (default: 0.7)
Sorts by confidence (highest first)
Returns top matches joined with "|" separator

6. Output Decision

If no matches found → mark as "JUNK"
If matches below threshold → mark as "JUNK"
If valid matches found → return codes with confidence and explanation
Run through this command :-python3 file1.py \
  --nucc path/to/nucc_taxonomy.csv \
  --input path/to/raw_specialties.csv \
  --out path/to/output.csv \
  --confidence 0.7
